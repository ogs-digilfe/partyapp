# アプリケーションデザイン

## １．フォルダ構成

```text
# 作成途上
partyapp_workspace/
├── .partyapp/                # partyappのpython仮想環境
├── tests/                    # ユニットテスト用
│   ├── __init__.py
│   └── test_user.py
└── partyapp/                 # partyappアプリコンテンツ(=gitリポジトリ)用
    ├── __init__.py
    ├── 0010.DESIGN.md        # このファイル
    ├── 0020.SETUP_HOST.md    # 構築手順
    ├── 0030.TUTORIAL.md      # コード作成の順番
    ├── 0040.MODEL.md         # SQLAlchemyモデル(テーブルオブジェクト/以下、モデル)に関しての解説
    ├── notebooks/            # Jupyterノートブック用（分析・試作）
    │   ├── 01_data_explore.ipynb
    │   └── 02_model_test.ipynb
    ├── cli.py                # ここでpartyappアプリケーションの便利なコマンドを作成
    ├── config.py             # partyappdb接続情報の設定(partyappdbのURIや環境変数読み込んで設定)
    ├── db/                   # モデルの定義や接続設定用
    │   ├── __init__.py
    │   ├── base.py           # モデルのBaseクラス宣言 + セッション作成
    │   └── models/           # モデルおよびモデルのenmu制約定義用
    │       ├── __init__.py   # partyappの全モデルをSQLAlchemyから読み出すための定義
    │       ├── associations.py # 中間テーブル(T_LAW_CATEGORY_MAP, T_PARTY_LAW_ROLE)のモデルを定義
    │       ├── category.py   # M_CATEGORYテーブルのモデルを定義
    │       ├── enums.py      # partyapp内のテーブルで適用するenum制約をこのファイルでまとめて定義
    │       ├── law.py        # T_LAWテーブルのモデルを定義   
    │       ├── party.py      # M_PARTYテーブルのモデルを定義    
    │       └── user.py
    ├── services/             # ビジネスロジック（CRUD操作など）
    │   ├── __init__.py
    │   └── user_service.py
    ├── utils/                # 共通関数やヘルパー用
    │   ├── __init__.py
    │   └── date_utils.py
    └── requirements.txt      # pypi package list
```

## ２．データベースサーバとデータベース

データベースサーバ接続情報  
適宜構築済データベースの設定値に変更のこと。

```text
host: 192.168.0.165:3306
middleware: mariadb 15.1
dbname: partyapp
user: username
password: password
```

## ２．テーブル設計

```text
////////////////////////////////////////////////////
// Enums
////////////////////////////////////////////////////

Enum law_type {
  constitution        // 憲法（国）
  statute             // 法律（国）
  cabinet_order       // 政令（国）
  ministerial_order   // 省令（国）
  national_rule       // 規則（国）
  ordinance           // 条例（地方）
  local_rule          // 規則（地方）
}

Enum jurisdiction_level {
  national        // 国
  local           // 地方公共団体
}

Enum party_role {
  submitter       // 提出
  co_submitter    // 共同提出
  cabinet         // 内閣提出
  coalition       // 与党として推進
  voted_for       // 賛成
  voted_against   // 反対
}

Enum category_type {
  politics        // 政治: 政権運営、選挙制度、外交姿勢など
  economy         // 経済: 税制、金融、雇用、産業支援など
  international   // 国際: 外交、安全保障、移民など
  environment_science // 環境・科学: 脱炭素、災害対策、研究開発支援など
  culture         // カルチャー: 表現の自由、芸術、デジタル文化など
  life_medical    // 暮らし・学び・医療: 医療制度、教育方針、子育て支援など
  society         // 社会: 差別・人権・治安・災害復興など
}

////////////////////////////////////////////////////
// Tables
////////////////////////////////////////////////////

Table M_PARTY {
  id              char(18) [pk]
  name            varchar(50) [not null, unique, note: '政党名']
  short_name      varchar(50) [note: '略称']
  founded_on      date [note: '成立日']
  dissolved_on    date [note: '解散日']
}

Table M_CATEGORY {
  id              char(18) [pk]
  name            category_type [not null, unique, note: '分類（固定Enum）']
  description     text [note: '説明（任意）']
}

Table T_LAW {
  id                  char(18) [pk]
  title               varchar(100) [not null, note: '法令名（正式名）']
  law_number          varchar(50) [unique, note: '例: 令和6年法律第○号（任意）']
  type                law_type [not null, note: '法令種別']
  jurisdiction        jurisdiction_level [not null, note: '管轄レベル（国／地方）']
  promulgated_on      date [note: '公布日']
  enacted_on          date [note: '施行日/成立日']
  summary             text [note: '概要']
  source_url          text [note: '出典URL']
  source_hash         varchar(64) [note: '同一判定用ハッシュ']
  created_at          datetime [not null, note: '作成日時']
  updated_at          datetime [not null, note: '更新日時']
}

Table T_LAW_CATEGORY_MAP {
  law_id          char(18) [not null, ref: > T_LAW.id]
  category_id     char(18) [not null, ref: > M_CATEGORY.id]
  Note: '法令と分類の多対多対応表'
  Indexes {
    (law_id, category_id) [pk]
    category_id
  }
}

Table T_PARTY_LAW_ROLE {
  law_id          char(18) [not null, ref: > T_LAW.id]
  party_id        char(18) [not null, ref: > M_PARTY.id]
  role            party_role [not null, note: '政党の関与種別']
  note            text [note: '採決比率や会派メモ']
  Indexes {
    (law_id, party_id, role) [pk]
    party_id
    role
  }
}
```